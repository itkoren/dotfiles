{{- if and (eq .chezmoi.os "darwin") (hasKey .apps "darwin") -}}
#!{{ lookPath "sh" }}

{{- $sourceDir := .chezmoi.sourceDir -}}

# apps.yaml hash: {{ include ".chezmoidata/apps.yaml" | sha256sum }}
source "$HOME/.config/zsh/conf.d/functions/.age.sh"

{{ if hasKey .apps.darwin "universal" }}

{{ range .apps.darwin.universal.encrypted -}}
age_decrypt_extract {{ $sourceDir }}/{{ . | quote }} "~/Downloads"
{{ end -}}
{{ range .apps.darwin.universal.plain -}}
cp {{ $sourceDir }}/{{ . | quote }} "~/Downloads"
{{ end -}}

{{ end -}}


{{ if and (.environment.work) (hasKey .apps.darwin "work") }}

{{ range .apps.darwin.work.encrypted -}}
age_decrypt_extract {{ $sourceDir }}/{{ . | quote }} "~/Downloads"
{{ end -}}

{{ range .apps.darwin.work.plain -}}
cp {{ $sourceDir }}/{{ . | quote }} "~/Downloads"
{{ end -}}

{{ end -}}


{{ if and (.environment.personal) (hasKey .apps.darwin "personal") }}

{{ range .apps.darwin.personal.encrypted -}}
age_decrypt_extract {{ $sourceDir }}/{{ . | quote }} "~/Downloads"
{{ end -}}

{{ range .apps.darwin.personal.plain -}}
cp {{ $sourceDir }}/{{ . | quote }} "~/Downloads"
{{ end -}}

{{ end -}}

{{ end -}}

